<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Spring Boot  使用 GraalVM 构建 | Heimdall 权限管理框架</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="一个完善易用的 JavaWeb 权限管理框架">
    <link rel="preload" href="/assets/css/0.styles.441a4e51.css" as="style"><link rel="preload" href="/assets/js/app.d3c4e24f.js" as="script"><link rel="preload" href="/assets/js/2.ea2a0444.js" as="script"><link rel="preload" href="/assets/js/32.3ae44432.js" as="script"><link rel="prefetch" href="/assets/js/10.4b3bee1f.js"><link rel="prefetch" href="/assets/js/11.033191b3.js"><link rel="prefetch" href="/assets/js/12.fc23889e.js"><link rel="prefetch" href="/assets/js/13.190eee66.js"><link rel="prefetch" href="/assets/js/14.43402f8d.js"><link rel="prefetch" href="/assets/js/15.506e6787.js"><link rel="prefetch" href="/assets/js/16.434e7eec.js"><link rel="prefetch" href="/assets/js/17.84f69047.js"><link rel="prefetch" href="/assets/js/18.bfd669ee.js"><link rel="prefetch" href="/assets/js/19.3259c6f8.js"><link rel="prefetch" href="/assets/js/20.b7a329bd.js"><link rel="prefetch" href="/assets/js/21.99da374a.js"><link rel="prefetch" href="/assets/js/22.6f0fefa2.js"><link rel="prefetch" href="/assets/js/23.4963e6a1.js"><link rel="prefetch" href="/assets/js/24.b0a706cd.js"><link rel="prefetch" href="/assets/js/25.9dad8e1a.js"><link rel="prefetch" href="/assets/js/26.e89e33fc.js"><link rel="prefetch" href="/assets/js/27.d321a6c5.js"><link rel="prefetch" href="/assets/js/28.29350d27.js"><link rel="prefetch" href="/assets/js/29.2ff4b0e9.js"><link rel="prefetch" href="/assets/js/3.d3add83d.js"><link rel="prefetch" href="/assets/js/30.c9b240b6.js"><link rel="prefetch" href="/assets/js/31.74c5965d.js"><link rel="prefetch" href="/assets/js/4.5df22fa4.js"><link rel="prefetch" href="/assets/js/5.9e09fdaa.js"><link rel="prefetch" href="/assets/js/6.e065fcd5.js"><link rel="prefetch" href="/assets/js/7.09beea46.js"><link rel="prefetch" href="/assets/js/8.22945b73.js"><link rel="prefetch" href="/assets/js/9.cad0b848.js">
    <link rel="stylesheet" href="/assets/css/0.styles.441a4e51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Heimdall 权限管理框架</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/heimdall/">
          Heimdall教程
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/spring/" class="router-link-active">
          Spring 随笔
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/luterc" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/spring/graalvm.html" aria-current="page" title="Spring Boot  使用 GraalVM 构建" class="active sidebar-link">Spring Boot  使用 GraalVM 构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/graalvm.html#背景" title="背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/spring/graalvm.html#目标" title="目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header"><a href="/spring/graalvm.html#搭建基础项目" title="搭建基础项目" class="sidebar-link">搭建基础项目</a></li><li class="sidebar-sub-header"><a href="/spring/graalvm.html#打包运行" title="打包运行" class="sidebar-link">打包运行</a></li><li class="sidebar-sub-header"><a href="/spring/graalvm.html#使用-graalvm-打包" title="使用 GraalVM 打包" class="sidebar-link">使用 GraalVM 打包</a></li><li class="sidebar-sub-header"><a href="/spring/graalvm.html#结语" title="结语" class="sidebar-link">结语</a></li></ul></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="spring-boot-使用-graalvm-构建"><a href="#spring-boot-使用-graalvm-构建" class="header-anchor">#</a> Spring Boot  使用 GraalVM 构建</h1> <blockquote><p>本文<a target="_blank" href="https://github.com/luterc/graalvm-demo">示例代码</a></p></blockquote> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>容器化、函数式、低代码、云原生各种概念和技术层出不穷，无奈，与时俱进，跟进研究，发现 Quarkus 最近比较火爆，抽空研究了一下，这就引出了本文的猪脚: <a href="https://www.graalvm.org/">GraalVM</a>，口号是:<strong>Run Programs Faster Anywhere</strong></p> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <p>GraalVM Native Image是由Oracle Labs开发的一种AOT编译器，支持基于JVM的高级语言，如Java, Scala, Clojure, Kotlin。Native Image以Java bytecode作为输入，将所有应用所需的class依赖项及runtime库打包编译生成一个单独可执行文件。具有高效的startup及较小的运行时内存开销的优势。</p> <p>与传统的Java虚拟机不同，Native Image是封闭式的静态分析和编译，不支持class的动态加载，程序运行所需要的多有依赖项均在静态分析阶段完成。此外GraalVM Native Image运行在一个名为SubstrateVM的轻量级的虚拟机之上。虽说是轻量级虚拟机，SubstrateVM却拥有运行Java程序所必需的所有组件，包括deoptimizer、gc及thread scheduling等。
目前GraalVM Native Image并没有完全支持多有的Java动态特性，如不支持class动态加载。
感兴趣的童鞋可以点击去看看，这里就不过多介绍了。</p> <blockquote><p>本文不涉及 GraalVM  的安装和部署，只实践 SpringBoot 基于 GraalVM 的构建</p></blockquote> <p>SpringBoot 从 2.3 开始，已经支持 GraalVM 打包。</p> <h2 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h2> <ul><li>构建一个基本的增SpringBoot 项目</li> <li>分别使用普通 jar 和 Native-image 方式打包，对比资源占用情况。</li></ul> <h2 id="搭建基础项目"><a href="#搭建基础项目" class="header-anchor">#</a> 搭建基础项目</h2> <p>用你熟悉的工具搭建一个基本的 SpringBoot 项目</p> <p>猫咪DTO:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><p>实现基本增删改查 API(模拟)</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cats&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatController</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">CatDTO</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span> <span class="token class-name">CatDTO</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> param<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;Success&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PutMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">CatDTO</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span> <span class="token class-name">CatDTO</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> param<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">CatDTO</span> param<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;列表查看&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CatDTO</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CatDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>



</code></pre></div><blockquote><p>其他代码省略，感兴趣的童鞋请参考 : <a href="">源码</a></p></blockquote> <h2 id="打包运行"><a href="#打包运行" class="header-anchor">#</a> 打包运行</h2> <p>打包</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ./mvnw package
</code></pre></div><p>运行</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">cd</span> target
$ java -jar graalvm-demo-0.0.1-SNAPSHOT.jar
</code></pre></div><p>留意一下启动时间，我本机的是:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>。。。。。。。
Started GraalvmDemoApplication <span class="token keyword">in</span> <span class="token number">1.774</span> seconds <span class="token punctuation">(</span>JVM running <span class="token keyword">for</span> <span class="token number">2.212</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看到，启动用了将近 2 秒钟。 如果引入数据库、MQ等，肯定还会更多。</p> <p>再看看内存使用情况:</p> <div class="language-language extra-class"><pre class="language-text"><code>命令:

$ ps aux | grep graalvm-demo | awk '{print $1 &quot;\t&quot; $2 &quot;\t&quot; $3 &quot;\t&quot; $4 &quot;\t&quot; $5 &quot;\t&quot; $6/1024&quot;MB&quot; &quot;\t&quot; $11$12$13$14$15$16$17$18 }'

结果:
51460	0.0	2.9	10508892	473.863MB	/usr/bin/java-jargraalvm-demo-0.0.1-SNAPSHOT.jar

</code></pre></div><p>473.863MB ,就这么简单个功能的应用，将近 500MB 内存没了。这个资源占用，不小！ 相比之下，PHP、C#、甚至 Nodejs 实现同样功能，哪个都没 Java 吃的多~~妥妥的干饭专家....</p> <h2 id="使用-graalvm-打包"><a href="#使用-graalvm-打包" class="header-anchor">#</a> 使用 GraalVM 打包</h2> <p>GraalVM的安装，请参考官方文档，本文不做介绍。</p> <p>安装完毕后，记得安装 native-image 本地映像打包插件。安装命令:</p> <blockquote><p>gu install native-image</p></blockquote> <p>本例中具体环境如下:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>// GraalVM 版本
$ java -version
openjdk version <span class="token string">&quot;1.8.0_282&quot;</span>
OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_282-b07<span class="token punctuation">)</span>
OpenJDK <span class="token number">64</span>-Bit Server VM GraalVM CE <span class="token number">20.3</span>.1 <span class="token punctuation">(</span>build <span class="token number">25.282</span>-b07-jvmci-20.3-b09, mixed mode<span class="token punctuation">)</span>
</code></pre></div><h3 id="调整示例项目"><a href="#调整示例项目" class="header-anchor">#</a> 调整示例项目</h3> <p>为了使用 GraalVM 打包，SpringBoot 项目需要进行一些调整</p> <h4 id="修改启动类"><a href="#修改启动类" class="header-anchor">#</a> 修改启动类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//@SpringBootApplication</span>
<span class="token comment">//这里proxyBeanMethods方法代理关闭</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GraalvmDemoApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GraalvmDemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="修改-pom-xml"><a href="#修改-pom-xml" class="header-anchor">#</a> 修改 pom.xml</h4> <p>SringBoot 提供了 GraalVM Native 打包的 Maven 插件，可通过如下方式引入:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.luter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>graalvm-demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>graalvm-demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--        graalvm 打包 插件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context-indexer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.experimental<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-graalvm-native<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--    graalvm 插件不在中央库，所以还需要指定 repository--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--        加一个 native 打包的 配置--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>native<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.graalvm.nativeimage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>native-image-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>20.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.luter.graalvmdemo.GraalvmDemoApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>buildArgs</span><span class="token punctuation">&gt;</span></span>-Dspring.native.remove-yaml-support=false
                                -Dspring.spel.ignore=true
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>buildArgs</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>native-image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>



</code></pre></div><h4 id="native-打包"><a href="#native-打包" class="header-anchor">#</a> Native 打包</h4> <p>打包命令:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ./mvnw -P native package
</code></pre></div><p>会显示如下信息:</p> <div class="language-language extra-class"><pre class="language-text"><code>


[com.luter.graalvmdemo.graalvmdemoapplication:49751]    classlist:   6,378.68 ms,  2.20 GB
   _____                     _                             _   __           __     _              
  / ___/    ____    _____   (_)   ____    ____ _          / | / /  ____ _  / /_   (_) _   __  ___ 
  \__ \    / __ \  / ___/  / /   / __ \  / __ `/         /  |/ /  / __ `/ / __/  / / | | / / / _ \
 ___/ /   / /_/ / / /     / /   / / / / / /_/ /         / /|  /  / /_/ / / /_   / /  | |/ / /  __/
/____/   / .___/ /_/     /_/   /_/ /_/  \__, /         /_/ |_/   \__,_/  \__/  /_/   |___/  \___/ 
        /_/                            /____/                                                     
Removing unused configurations
Verification turned on
Removing XML support
Removing SpEL support
Removing JMX support
Use -Dspring.native.verbose=true on native-image call to see more detailed information from the feature
[com.luter.graalvmdemo.graalvmdemoapplication:49751]        (cap):   3,263.36 ms,  2.51 GB
feature operating mode: reflection (spring init active? false)
Found #15 types in static reflection list to register
Skipping #12 types not on the classpath
Attempting proxy registration of #12 proxies
Skipped registration of #4 proxies - relevant types not on classpath
[com.luter.graalvmdemo.graalvmdemoapplication:49751]        setup:  12,937.89 ms,  2.93 GB


。。。。。。。。


[com.luter.graalvmdemo.graalvmdemoapplication:49751]     (clinit):   3,141.89 ms,  5.59 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]   (typeflow):  73,234.16 ms,  5.59 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]    (objects):  92,334.47 ms,  5.59 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]   (features):  18,891.77 ms,  5.59 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]     analysis: 196,029.89 ms,  5.59 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]     universe:   5,281.74 ms,  5.62 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]      (parse):  17,570.40 ms,  5.28 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]     (inline):  23,751.47 ms,  7.13 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]    (compile):  73,916.12 ms,  7.74 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]      compile: 123,244.44 ms,  7.74 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]        image:  15,852.33 ms,  7.83 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]        write:   3,908.93 ms,  7.83 GB
[com.luter.graalvmdemo.graalvmdemoapplication:49751]      [total]: 371,061.00 ms,  7.83 GB
[INFO]
[INFO] --- spring-boot-maven-plugin:2.4.2:repackage (repackage) @ graalvm-demo ---
[INFO] Replacing main artifact with repackaged archive
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  06:21 min
[INFO] Finished at: 2021-01-27T12:52:16+08:00
[INFO] ------------------------------------------------------------------------


</code></pre></div><p>这一步还是比较慢的，我本机用了将近 4 分钟,请耐心等待.打包完毕后，target 目录下会出现运行文件:
com.luter.graalvmdemo.graalvmdemoapplication，这个文件 57.6MB ，普通 Fat Jar 方式打包文件:graalvm-demo-0.0.1-SNAPSHOT.jar 17.7MB，大了三倍多</p> <p>运行 :</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ./com.luter.graalvmdemo.graalvmdemoapplication

  <span class="token builtin class-name">.</span>   ____          _            __ _ _
 /<span class="token punctuation">\</span><span class="token punctuation">\</span> / ___<span class="token string">'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '</span>_ <span class="token operator">|</span> <span class="token string">'_| | '</span>_ <span class="token punctuation">\</span>/ _` <span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>
 <span class="token punctuation">\</span><span class="token punctuation">\</span>/  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token string">'  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.4.2)

2021-01-27 13:31:04.357  INFO 51785 --- [           main] c.l.graalvmdemo.GraalvmDemoApplication   : Starting GraalvmDemoApplication v0.0.1-SNAPSHOT using Java 1.8.0_282 on localhost with PID 51785 (/opt/luter/develop/temp/graalvm-demo/target/com.luter.graalvmdemo.graalvmdemoapplication started by clt in /opt/luter/develop/temp/graalvm-demo/target)
2021-01-27 13:31:04.357  INFO 51785 --- [           main] c.l.graalvmdemo.GraalvmDemoApplication   : No active profile set, falling back to default profiles: default
2021-01-27 13:31:04.387  INFO 51785 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 10000 (http)
Jan 27, 2021 1:31:04 PM org.apache.coyote.AbstractProtocol init
INFO: Initializing ProtocolHandler [&quot;http-nio-10000&quot;]
Jan 27, 2021 1:31:04 PM org.apache.catalina.core.StandardService startInternal
INFO: Starting service [Tomcat]
Jan 27, 2021 1:31:04 PM org.apache.catalina.core.StandardEngine startInternal
INFO: Starting Servlet engine: [Apache Tomcat/9.0.41]
Jan 27, 2021 1:31:04 PM org.apache.catalina.core.ApplicationContext log
INFO: Initializing Spring embedded WebApplicationContext
2021-01-27 13:31:04.390  INFO 51785 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 33 ms
2021-01-27 13:31:04.401  INFO 51785 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService '</span>applicationTaskExecutor<span class="token string">'
Jan 27, 2021 1:31:04 PM org.apache.coyote.AbstractProtocol start
INFO: Starting ProtocolHandler [&quot;http-nio-10000&quot;]
2021-01-27 13:31:04.408  INFO 51785 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 10000 (http) with context path '</span>'
<span class="token number">2021</span>-01-27 <span class="token number">13</span>:31:04.408  INFO <span class="token number">51785</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> c.l.graalvmdemo.GraalvmDemoApplication   <span class="token builtin class-name">:</span> Started GraalvmDemoApplication <span class="token keyword">in</span> <span class="token number">0.066</span> seconds <span class="token punctuation">(</span>JVM running <span class="token keyword">for</span> <span class="token number">0.068</span><span class="token punctuation">)</span>

</code></pre></div><p>这个启动太顺滑了，回车后，几乎是秒开，用时0.066秒。传统 Fatjar 方式启动用时:1.774秒，20 多倍的提升。试想一下，一个动不动启动半分钟的大型项目上云，是不是很激动人心?</p> <p>再看看内存占用情况:</p> <div class="language-language extra-class"><pre class="language-text"><code>//命令

$ ps aux | grep com.luter.graalvmdemo.graalvmdemoapplication | grep S+ | awk '{print $1 &quot;\t&quot; $2 &quot;\t&quot; $3 &quot;\t&quot; $4 &quot;\t&quot; $5 &quot;\t&quot; $6/1024&quot;MB&quot; &quot;\t&quot; $11 }'

//结果
51785	0.0	0.3	4526816	53.8711MB	./com.luter.graalvmdemo.graalvmdemoapplication
</code></pre></div><p>内存占用:53.8711MB ,相比较传统 FatJar 的 473.863MB ，差不多 10 倍。
从启动速度到资源占用，都大幅度降低了，这对降低部署成本，还是很有帮助的。</p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <blockquote><p>本文<a target="_blank" href="https://github.com/luterc/graalvm-demo">示例代码</a></p></blockquote> <p>整个过程，还是比较折腾的，尤其是 Graalvm 的安装，网络的原因，比较卡比较慢。
还有就是，由于不支持 CGLIB 的动态代理了，很多 SpringBoot的自动配置功能无法使用，</p> <p>如果你的项目对 SpringBoot 的各项特性依赖很强，谨慎入坑。否则，你也可以考虑一下:Quarkus。</p> <p>官网有专门文档介绍支持情况,有兴趣的童鞋可以自行去查看。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新::</span> <span class="time">1/29/2021, 11:05:57 PM</span></div></footer> <!----> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d3c4e24f.js" defer></script><script src="/assets/js/2.ea2a0444.js" defer></script><script src="/assets/js/32.3ae44432.js" defer></script>
  </body>
</html>