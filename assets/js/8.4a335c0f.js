(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{732:function(t,e,a){"use strict";a.r(e);var s=a(104),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#授权"}},[t._v("#")]),t._v(" 授权")]),t._v(" "),a("h2",{attrs:{id:"授权-能做什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#授权-能做什么"}},[t._v("#")]),t._v(" 授权 (能做什么?)")]),t._v(" "),a("p",[a("strong",[t._v("Authorization")]),t._v("，也就是授权操作，指的是对来访用户是否具备某操作权限进行判断进而采取对应措施。授权解决“能做什么?”的问题。")]),t._v(" "),a("h2",{attrs:{id:"基本思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本思路"}},[t._v("#")]),t._v(" 基本思路")]),t._v(" "),a("p",[t._v("通过对比用户具有的权限(用户权限)与访问资源所需的权限(系统权限)，进而确定用户是否具备权限。")]),t._v(" "),a("h2",{attrs:{id:"路由授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由授权"}},[t._v("#")]),t._v(" 路由授权")]),t._v(" "),a("h3",{attrs:{id:"说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),a("p",[t._v("路由授权通过拦截器实现。路由权限支持一下两种：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("精确路由路径鉴权\n精确路由路径指的是系统内 url 都具有唯一性，不区分  Method")]),t._v(" "),a("p",[t._v("如：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("列表: /pet/cat/list")])]),t._v(" "),a("li",[a("p",[t._v("新增: /pet/cat/save")])]),t._v(" "),a("li",[a("p",[t._v("修改: /pet/cat/update")])]),t._v(" "),a("li",[a("p",[t._v("删除: /pet/cat/delete")]),t._v(" "),a("p",[t._v("这种模式，系统提供了：SimpleGrantedAuthority 授权实体，通过唯一 perm 标识一个路由资源\n首先根据系统拦截规则对 url 进行拦截，然后通过需要的 perm 标识与用户具有的 perm 标识进行比对判定是否授权。")]),t._v(" "),a("p",[t._v("如下所示：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("url 资源")]),t._v(" "),a("th",[t._v("权限标识 perm")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("/pet/cat/list")]),t._v(" "),a("td",[t._v("catList")])]),t._v(" "),a("tr",[a("td",[t._v("/pet/cat/save")]),t._v(" "),a("td",[t._v("catSave")])])])])])])]),t._v(" "),a("li",[a("p",[t._v("Restful资源授权")]),t._v(" "),a("p",[t._v("对，就是你熟悉的那个 "),a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2011/09/restful.html"}},[t._v("Restful")]),t._v("\n。这种模式下 url 不再唯一，需要 method+url规则 定位路由\n如：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("列表: GET /pet/cat")])]),t._v(" "),a("li",[a("p",[t._v("详情: GET /pet/cat/*")])]),t._v(" "),a("li",[a("p",[t._v("新增: POST /pet/cat")])]),t._v(" "),a("li",[a("p",[t._v("修改: PUT /pet/cat")])]),t._v(" "),a("li",[a("p",[t._v("删除: DELETE /pet/cat/{id}")]),t._v(" "),a("p",[t._v('Restful资源授权，系统提供了MethodAndUrlGrantedAuthority授权实体，通过 method+url 的形式组合权限。\n首先根据系统拦截规则对，对请求 url 进行拦截，然后遍历用户具有的权限，如果有 url 相同，且 method 与当前请求\nmethod 相同或者 method = "all"的权限，则授权通过。')])])]),t._v(" "),a("p",[t._v("如下所示：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("资源 url")]),t._v(" "),a("th",[t._v("value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("/pet/cat")]),t._v(" "),a("td",[t._v('""')])]),t._v(" "),a("tr",[a("td",[t._v("/pet/cat")]),t._v(" "),a("td",[t._v('""')])])])]),t._v(" "),a("p",[t._v("这种模式的系统权限，其实就是一个拦截器匹配规则，需要使用有序 Map，保证拦截顺序")])])]),t._v(" "),a("h3",{attrs:{id:"授权逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#授权逻辑"}},[t._v("#")]),t._v(" 授权逻辑")]),t._v(" "),a("ol",{attrs:{start:"0"}},[a("li",[t._v("当用户请求某个路由资源，如: GET /pet/cat")]),t._v(" "),a("li",[t._v("查找系统权限拦截规则,先从缓存获取,没有则从数据库获取然后存入缓存，返回")]),t._v(" "),a("li",[t._v("遍历系统权限，以 url 进行 Ant 风格匹配判断，如果匹配，则拦截授权开始，不匹配则通过")]),t._v(" "),a("li",[t._v("获取当前登录用户具有的权限列表，遍历匹配")]),t._v(" "),a("li",[t._v("判断当前系统支持的授权形式，如果是:MethodAndUrlGrantedAuthority，进入 Restful 风格资源鉴权，\n如果是：SimpleGrantedAuthority 进入精确路由路径模式鉴权。")]),t._v(" "),a("li",[t._v('Restful资源授权\n5.1 拿到当前request 的 request.method 和 request.url,遍历用户具备的所有权限\n5.2 如果存在与 user.url = request.url ,则继续判断 method，否则，不具备权限。\n5.3 如果user.method ==request.method ||"all".equals(user.method)，则具备权限。')]),t._v(" "),a("li",[t._v("精确路由路径鉴权\n6.1 通过 request.url 从系统权限拦截规则（Map）中获取到对应规则\n6.2 遍历用户权限，以 url查找，找到继续判断用户 perm （SimpleGrantedAuthority.getAuthority()）与拦截规则.perm 是否相等? 相等，则授权通过,否则授权不通过。")])]),t._v(" "),a("h2",{attrs:{id:"注解授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解授权"}},[t._v("#")]),t._v(" 注解授权")]),t._v(" "),a("p",[t._v("系统实现了如下几类注解权限：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  是否登录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresUser")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//是否具备单个角色 如: @RequiresRole("admin")')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresRole")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//是否具备多个角色其一或者全部，如:@RequiresRoles(value={"admin","user"},mode=Mod.Any)')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresRoles")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//是否具备某个权限标识符，如: @RequiresPermission("catList")')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresPermission")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//是否具备多个权限标识符其一或者全部，如:@RequiresPermissions(value={"catList","catSave"},mode=Mod.ALL)')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequiresPermissions")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);