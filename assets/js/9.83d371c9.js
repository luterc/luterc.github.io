(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{734:function(t,a,s){"use strict";s.r(a);var e=s(104),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"系统权限缓存设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统权限缓存设计"}},[t._v("#")]),t._v(" 系统权限缓存设计")]),t._v(" "),s("h2",{attrs:{id:"授权场景分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#授权场景分析"}},[t._v("#")]),t._v(" 授权场景分析")]),t._v(" "),s("h3",{attrs:{id:"_1-权限标识符授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-权限标识符授权"}},[t._v("#")]),t._v(" 1. 权限标识符授权")]),t._v(" "),s("p",[t._v("这种情况下，url 不能重复，也就是不区分 method.每一个 url 都会对应一个唯一权限标识符，如:")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("资源 url")]),t._v(" "),s("th",[t._v("标识符")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("列表查询")]),t._v(" "),s("td",[t._v("/pet/cat/list")]),t._v(" "),s("td",[t._v("catList")])]),t._v(" "),s("tr",[s("td",[t._v("新增数据")]),t._v(" "),s("td",[t._v("/pet/cat/save")]),t._v(" "),s("td",[t._v("catSave")])]),t._v(" "),s("tr",[s("td",[t._v("查看详情")]),t._v(" "),s("td",[t._v("/pet/cat/detail")]),t._v(" "),s("td",[t._v("catDetail")])])])]),t._v(" "),s("p",[t._v("这种情况下，权限缓存，属于一对一关系，可以采用如下数据格式缓存 :")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" perms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("以 url 为 key，以标识符为 value")]),t._v(" "),s("h3",{attrs:{id:"_2-角色授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-角色授权"}},[t._v("#")]),t._v(" 2. 角色授权")]),t._v(" "),s("p",[t._v("RBAC 权限模型中，一个角色可以拥有多个 url 资源，一个用户可以拥有多个角色。")]),t._v(" "),s("p",[t._v("对应到授权管理，就意味着拦截一个 url，同时需要知道这个 url 需要具备哪些角色才能访问。如：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("资源 url")]),t._v(" "),s("th",[t._v("角色")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("列表查询")]),t._v(" "),s("td",[t._v("/pet/cat/list")]),t._v(" "),s("td",[t._v("admin,guest,user")])]),t._v(" "),s("tr",[s("td",[t._v("新增数据")]),t._v(" "),s("td",[t._v("/pet/cat/save")]),t._v(" "),s("td",[t._v("admin,user")])]),t._v(" "),s("tr",[s("td",[t._v("查看详情")]),t._v(" "),s("td",[t._v("/pet/cat/detail")]),t._v(" "),s("td",[t._v("guest,user")])])])]),t._v(" "),s("p",[t._v("这种情况下，url 不可重复。\n对应到缓存中，就是一个 key 对应一个角色集合,一对多关系。\n可以采用如下数据格式缓存:")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" perms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-restful-资源授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-restful-资源授权"}},[t._v("#")]),t._v(" 3. Restful 资源授权")]),t._v(" "),s("p",[t._v("Restful，表现层状态转移，简单说就是：URL定位资源，用HTTP动词（GET,POST,DELETE,DETC）描述操作。这种场景下，需要用 Method + url 组合来唯一定位一个权限项。\n如：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("操作")]),t._v(" "),s("th",[t._v("资源 url")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("列表查询")]),t._v(" "),s("td",[t._v("GET")]),t._v(" "),s("td",[t._v("/pet/cat")])]),t._v(" "),s("tr",[s("td",[t._v("新增数据")]),t._v(" "),s("td",[t._v("POST")]),t._v(" "),s("td",[t._v("/pet/cat")])]),t._v(" "),s("tr",[s("td",[t._v("查看详情")]),t._v(" "),s("td",[t._v("GET")]),t._v(" "),s("td",[t._v("/pet/cat/*")])])])]),t._v(" "),s("p",[t._v('这种资源风格，url 就会存在重复，所以不能只通过 url 唯一定位资源了，可以采用 Method+":"+url的形式唯一定位。\n对应授权判定逻辑，首先需要根据 url 判断这个 url 是否需要授权拦截，这一步，url 是否重复不重要，需要被拦截，再判定用户具有的此 url 的 Method 是否与当前访问资源的 Method 相同，Method 相同，则可认为具备权限。')]),t._v(" "),s("p",[t._v("这种情况下，权限缓存只需要 key 即可，value 不参与鉴权流程，所以采用 :")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" perms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("综上")]),t._v(" "),s("p",[t._v("  场景 1 和 2 其实可以算作同一种授权方式，这种授权方式 通过 url 唯一定位资源，通过特定字符串(角色、权限标识)来判定是否授权。")]),t._v(" "),s("p",[t._v("  场景 3 Restful 风格资源是比较特殊的授权方式，只能通过 method+url 来定位唯一资源。")]),t._v(" "),s("h2",{attrs:{id:"结论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" "),s("strong",[t._v("结论")])]),t._v(" "),s("ul",[s("li",[t._v("全局系统权限缓存采用")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//全局系统缓存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//key = url")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//value = 角色标识或者权限标识")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" perms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);